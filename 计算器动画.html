<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>维度折叠 | Folding Dimensions</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Serif+SC:wght@200;400;600&family=Cinzel:wght@400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .cinema-container {
            width: 100vw;
            height: 56.25vw;
            max-height: 100vh;
            max-width: 177.78vh;
            position: relative;
            background: linear-gradient(180deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%);
            overflow: hidden;
        }
        
        /* 电影黑边 */
        .letterbox {
            position: absolute;
            left: 0;
            right: 0;
            height: 8%;
            background: #000;
            z-index: 100;
        }
        .letterbox.top { top: 0; }
        .letterbox.bottom { bottom: 0; }
        
        /* 氛围粒子 */
        .particles {
            position: absolute;
            inset: 0;
            overflow: hidden;
            opacity: 0.3;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #fff;
            border-radius: 50%;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }
        
        /* 场景容器 */
        .scene {
            position: absolute;
            inset: 8% 0;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1500px;
        }
        
        /* 计算器 */
        .calculator {
            width: 360px;
            height: 560px;
            background: linear-gradient(145deg, #2a2a3a, #1a1a28);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 
                0 50px 100px rgba(0,0,0,0.8),
                0 0 0 1px rgba(255,255,255,0.05),
                inset 0 1px 0 rgba(255,255,255,0.1);
            transform-style: preserve-3d;
            transform: rotateX(5deg);
            transition: transform 0.5s;
        }
        
        .calculator.shake {
            animation: shake 0.1s infinite;
        }
        
        @keyframes shake {
            0%, 100% { transform: rotateX(5deg) translateX(0); }
            25% { transform: rotateX(5deg) translateX(-5px) rotateZ(-1deg); }
            75% { transform: rotateX(5deg) translateX(5px) rotateZ(1deg); }
        }
        
        /* 显示屏 - 修复显示问题 */
        .display {
            background: linear-gradient(180deg, #1a2a1a 0%, #0f1a0f 100%);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            height: 130px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-end;
            box-shadow: 
                inset 0 5px 20px rgba(0,0,0,0.5),
                0 0 30px rgba(0, 255, 100, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .display::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.1) 2px,
                rgba(0,0,0,0.1) 4px
            );
            pointer-events: none;
        }
        
        .display-label {
            font-family: 'Orbitron', monospace;
            font-size: 11px;
            color: #00ff8888;
            align-self: flex-start;
            letter-spacing: 1px;
        }
        
        .display-text {
            font-family: 'Orbitron', monospace;
            font-size: 36px;
            font-weight: 700;
            color: #00ff88;
            text-shadow: 
                0 0 10px #00ff88,
                0 0 20px #00ff88,
                0 0 40px #00ff8855;
            transition: all 0.05s;
            position: relative;
            z-index: 1;
            word-break: break-all;
            text-align: right;
            line-height: 1.2;
            max-width: 100%;
        }
        
        .display-text.glitch {
            animation: glitch 0.1s infinite;
        }
        
        @keyframes glitch {
            0% { transform: translate(0); filter: hue-rotate(0deg); }
            20% { transform: translate(-2px, 2px); filter: hue-rotate(90deg); }
            40% { transform: translate(2px, -2px); filter: hue-rotate(180deg); }
            60% { transform: translate(-2px, -2px); filter: hue-rotate(270deg); }
            80% { transform: translate(2px, 2px); filter: hue-rotate(360deg); }
            100% { transform: translate(0); }
        }
        
        /* 按键区域 */
        .keypad {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .key {
            height: 55px;
            border-radius: 10px;
            border: none;
            font-family: 'Orbitron', monospace;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.1s;
            position: relative;
            overflow: hidden;
        }
        
        .key-number {
            background: linear-gradient(145deg, #3a3a4a, #2a2a38);
            color: #fff;
            box-shadow: 0 4px 0 #1a1a28, 0 6px 10px rgba(0,0,0,0.3);
        }
        
        .key-op {
            background: linear-gradient(145deg, #ff6b35, #e55a2b);
            color: #fff;
            box-shadow: 0 4px 0 #b34420, 0 6px 10px rgba(0,0,0,0.3);
        }
        
        .key-func {
            background: linear-gradient(145deg, #4a4a5a, #3a3a48);
            color: #aaa;
            box-shadow: 0 4px 0 #2a2a38, 0 6px 10px rgba(0,0,0,0.3);
        }
        
        .key-cos {
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            color: #fff;
            box-shadow: 0 4px 0 #5b21b6, 0 6px 10px rgba(0,0,0,0.3);
            font-size: 16px;
        }
        
        .key.pressed {
            transform: translateY(4px);
            box-shadow: 0 0 0 transparent, 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .key-cos.active {
            animation: cosGlow 0.15s;
        }
        
        @keyframes cosGlow {
            0% { box-shadow: 0 4px 0 #5b21b6, 0 0 30px #8b5cf6; }
            100% { box-shadow: 0 4px 0 #5b21b6, 0 6px 10px rgba(0,0,0,0.3); }
        }
        
        /* 优雅标题 */
        .title-overlay {
            position: absolute;
            inset: 8% 0 8%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(ellipse at center, rgba(10,10,20,0.95) 0%, rgba(0,0,0,0.98) 100%);
            z-index: 50;
            opacity: 1;
            transition: opacity 1.5s ease-out;
        }
        
        .title-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .title-decoration {
            width: 120px;
            height: 1px;
            background: linear-gradient(90deg, transparent, #8b5cf6, transparent);
            margin-bottom: 40px;
            animation: decorPulse 3s infinite;
        }
        
        @keyframes decorPulse {
            0%, 100% { opacity: 0.5; width: 120px; }
            50% { opacity: 1; width: 180px; }
        }
        
        .main-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 72px;
            font-weight: 200;
            color: #ffffff;
            text-shadow: 
                0 0 40px rgba(139, 92, 246, 0.5),
                0 0 80px rgba(139, 92, 246, 0.3);
            letter-spacing: 20px;
            animation: titleBreathe 4s infinite ease-in-out;
        }
        
        @keyframes titleBreathe {
            0%, 100% { opacity: 0.9; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.02); }
        }
        
        .subtitle {
            font-family: 'Cinzel', serif;
            font-size: 16px;
            font-weight: 400;
            color: #666;
            margin-top: 30px;
            letter-spacing: 12px;
            text-transform: uppercase;
        }
        
        .title-decoration-bottom {
            width: 80px;
            height: 1px;
            background: linear-gradient(90deg, transparent, #666, transparent);
            margin-top: 40px;
        }
        
        .title-tagline {
            font-family: 'Noto Serif SC', serif;
            font-size: 14px;
            font-weight: 200;
            color: #555;
            margin-top: 60px;
            letter-spacing: 3px;
        }
        
        /* 字幕 */
        .caption {
            position: absolute;
            bottom: 12%;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Noto Serif SC', serif;
            font-size: 20px;
            font-weight: 400;
            color: #fff;
            text-align: center;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.9);
            opacity: 0;
            transition: opacity 0.5s;
            max-width: 80%;
            z-index: 60;
            letter-spacing: 2px;
        }
        
        .caption.show {
            opacity: 1;
        }
        
        /* 邪恶笑脸 */
        .evil-face {
            position: absolute;
            inset: 8% 0 8%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, #1a0020 0%, #000 100%);
            z-index: 55;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .evil-face.show {
            opacity: 1;
        }
        
        .evil-number {
            font-family: 'Orbitron', monospace;
            font-size: 100px;
            font-weight: 900;
            color: #ff0040;
            text-shadow: 
                0 0 30px #ff0040,
                0 0 60px #ff0040,
                0 0 120px #ff004088;
            animation: evilPulse 0.5s infinite alternate;
            position: relative;
        }
        
        @keyframes evilPulse {
            0% { transform: scale(1); filter: brightness(1); }
            100% { transform: scale(1.05); filter: brightness(1.3); }
        }
        
        .evil-eyes {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 100px;
        }
        
        .eye {
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #ff3366, #ff0040, #990020);
            border-radius: 50%;
            box-shadow: 0 0 30px #ff0040;
            animation: eyeGlow 1s infinite alternate;
        }
        
        @keyframes eyeGlow {
            0% { box-shadow: 0 0 30px #ff0040; }
            100% { box-shadow: 0 0 60px #ff0040, 0 0 100px #ff004088; }
        }
        
        .evil-mouth {
            width: 180px;
            height: 50px;
            border-bottom: 6px solid #ff0040;
            border-radius: 0 0 100px 100px;
            margin-top: 40px;
            box-shadow: 0 0 20px #ff0040;
        }
        
        .evil-text {
            font-family: 'Noto Serif SC', serif;
            font-size: 22px;
            font-weight: 400;
            color: #ff6688;
            margin-top: 60px;
            letter-spacing: 5px;
            animation: textFlicker 0.1s infinite;
        }
        
        @keyframes textFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        /* 脉冲波纹 */
        .pulse-ring {
            position: absolute;
            border: 2px solid #8b5cf6;
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }
        
        .pulse-ring.active {
            animation: pulseOut 0.5s ease-out;
        }
        
        @keyframes pulseOut {
            0% { 
                width: 50px; 
                height: 50px; 
                opacity: 1; 
                transform: translate(-50%, -50%);
            }
            100% { 
                width: 300px; 
                height: 300px; 
                opacity: 0; 
                transform: translate(-50%, -50%);
            }
        }
        
        /* 收敛进度条 */
        .convergence-bar {
            position: absolute;
            bottom: 18%;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .convergence-bar.show {
            opacity: 1;
        }
        
        .convergence-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #ff0040);
            width: 0%;
            transition: width 0.1s;
            box-shadow: 0 0 10px #8b5cf6;
        }
        
        .convergence-label {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Orbitron', monospace;
            font-size: 11px;
            color: #666;
            letter-spacing: 3px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .convergence-label.show {
            opacity: 1;
        }
        
        /* 迭代计数器 */
        .iteration-counter {
            position: absolute;
            top: 12%;
            right: 5%;
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            color: #555;
            opacity: 0;
            transition: opacity 0.3s;
            letter-spacing: 1px;
        }
        
        .iteration-counter.show {
            opacity: 1;
        }
        
        .iteration-counter span {
            color: #8b5cf6;
            font-size: 28px;
            font-weight: 700;
        }
        
        /* 重启按钮 */
        .restart-btn {
            position: absolute;
            bottom: 12%;
            right: 5%;
            padding: 12px 28px;
            font-family: 'Noto Serif SC', serif;
            font-size: 13px;
            background: transparent;
            color: #666;
            border: 1px solid #333;
            border-radius: 0;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s;
            z-index: 70;
            letter-spacing: 3px;
        }
        
        .restart-btn.show {
            opacity: 1;
        }
        
        .restart-btn:hover {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
            border-color: #8b5cf6;
        }
        
        /* 闪电效果 */
        .lightning {
            position: absolute;
            inset: 0;
            background: #fff;
            opacity: 0;
            pointer-events: none;
            z-index: 80;
        }
        
        .lightning.flash {
            animation: lightning 0.1s;
        }
        
        @keyframes lightning {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.3; }
        }
        
        /* 漩涡效果 */
        .vortex {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 500px;
            height: 500px;
            transform: translate(-50%, -50%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .vortex.show {
            opacity: 1;
        }
        
        .vortex-ring {
            position: absolute;
            inset: 0;
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 50%;
            animation: vortexSpin 3s linear infinite;
        }
        
        .vortex-ring:nth-child(1) { transform: scale(0.2); animation-duration: 2s; }
        .vortex-ring:nth-child(2) { transform: scale(0.4); animation-duration: 2.5s; animation-direction: reverse; }
        .vortex-ring:nth-child(3) { transform: scale(0.6); animation-duration: 3s; }
        .vortex-ring:nth-child(4) { transform: scale(0.8); animation-duration: 3.5s; animation-direction: reverse; }
        .vortex-ring:nth-child(5) { transform: scale(1); animation-duration: 4s; }
        
        @keyframes vortexSpin {
            from { transform: scale(var(--scale, 1)) rotate(0deg); }
            to { transform: scale(var(--scale, 1)) rotate(360deg); }
        }

        /* 数学符号装饰 */
        .math-symbol {
            position: absolute;
            font-family: 'Times New Roman', serif;
            font-size: 24px;
            color: rgba(139, 92, 246, 0.15);
            pointer-events: none;
            animation: symbolFloat 10s infinite ease-in-out;
        }

        @keyframes symbolFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.15; }
            50% { transform: translateY(-20px) rotate(10deg); opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div class="cinema-container">
        <div class="letterbox top"></div>
        <div class="letterbox bottom"></div>
        
        <div class="particles" id="particles"></div>
        
        <!-- 数学符号装饰 -->
        <div class="math-symbol" style="top: 20%; left: 10%;">∫</div>
        <div class="math-symbol" style="top: 30%; right: 15%; animation-delay: -2s;">∑</div>
        <div class="math-symbol" style="bottom: 25%; left: 8%; animation-delay: -4s;">∞</div>
        <div class="math-symbol" style="top: 40%; right: 8%; animation-delay: -6s;">π</div>
        <div class="math-symbol" style="bottom: 35%; right: 12%; animation-delay: -3s;">θ</div>
        <div class="math-symbol" style="top: 25%; left: 20%; animation-delay: -5s;">cos</div>
        
        <div class="scene">
            <div class="vortex" id="vortex">
                <div class="vortex-ring"></div>
                <div class="vortex-ring"></div>
                <div class="vortex-ring"></div>
                <div class="vortex-ring"></div>
                <div class="vortex-ring"></div>
            </div>
            
            <div class="calculator" id="calculator">
                <div class="display" id="display">
                    <div class="display-label" id="displayLabel">RAD</div>
                    <div class="display-text" id="displayText">0</div>
                </div>
                <div class="keypad">
                    <button class="key key-func">AC</button>
                    <button class="key key-func">+/-</button>
                    <button class="key key-func">%</button>
                    <button class="key key-op">÷</button>
                    
                    <button class="key key-number" data-num="7">7</button>
                    <button class="key key-number" data-num="8">8</button>
                    <button class="key key-number" data-num="9">9</button>
                    <button class="key key-op">×</button>
                    
                    <button class="key key-number" data-num="4">4</button>
                    <button class="key key-number" data-num="5">5</button>
                    <button class="key key-number" data-num="6">6</button>
                    <button class="key key-op">−</button>
                    
                    <button class="key key-number" data-num="1">1</button>
                    <button class="key key-number" data-num="2">2</button>
                    <button class="key key-number" data-num="3">3</button>
                    <button class="key key-op">+</button>
                    
                    <button class="key key-cos" id="cosKey">cos</button>
                    <button class="key key-number" data-num="0">0</button>
                    <button class="key key-number">.</button>
                    <button class="key key-op">=</button>
                </div>
                <div class="pulse-ring" id="pulseRing"></div>
            </div>
        </div>
        
        <div class="title-overlay" id="titleOverlay">
            <div class="title-decoration"></div>
            <div class="main-title">维度折叠</div>
            <div class="subtitle">Folding Dimensions</div>
            <div class="title-decoration-bottom"></div>
            <div class="title-tagline">—— 一个关于 cos 函数不动点的故事 ——</div>
        </div>
        
        <div class="caption" id="caption"></div>
        
        <div class="evil-face" id="evilFace">
            <div class="evil-number">
                <div class="evil-eyes">
                    <div class="eye"></div>
                    <div class="eye"></div>
                </div>
                0.739085
            </div>
            <div class="evil-mouth"></div>
            <div class="evil-text">所有数字，终将归于此处</div>
        </div>
        
        <div class="convergence-label" id="convergenceLabel">CONVERGENCE</div>
        <div class="convergence-bar" id="convergenceBar">
            <div class="convergence-fill" id="convergenceFill"></div>
        </div>
        
        <div class="iteration-counter" id="iterationCounter">
            ITERATIONS<br><span id="iterCount">0</span>
        </div>
        
        <div class="lightning" id="lightning"></div>
        
        <button class="restart-btn" id="restartBtn">重新体验</button>
    </div>

    <script>
        // 生成粒子
        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 50; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDelay = Math.random() * 20 + 's';
            particle.style.animationDuration = (15 + Math.random() * 10) + 's';
            particlesContainer.appendChild(particle);
        }

        // 元素引用
        const titleOverlay = document.getElementById('titleOverlay');
        const calculator = document.getElementById('calculator');
        const displayText = document.getElementById('displayText');
        const displayLabel = document.getElementById('displayLabel');
        const caption = document.getElementById('caption');
        const cosKey = document.getElementById('cosKey');
        const pulseRing = document.getElementById('pulseRing');
        const convergenceBar = document.getElementById('convergenceBar');
        const convergenceFill = document.getElementById('convergenceFill');
        const convergenceLabel = document.getElementById('convergenceLabel');
        const iterationCounter = document.getElementById('iterationCounter');
        const iterCount = document.getElementById('iterCount');
        const evilFace = document.getElementById('evilFace');
        const lightning = document.getElementById('lightning');
        const vortex = document.getElementById('vortex');
        const restartBtn = document.getElementById('restartBtn');

        let currentValue = 0;
        let isAnimating = false;

        // 显示字幕
        function showCaption(text, duration = 2000) {
            caption.textContent = text;
            caption.classList.add('show');
            return new Promise(resolve => {
                setTimeout(() => {
                    caption.classList.remove('show');
                    setTimeout(resolve, 500);
                }, duration);
            });
        }

        // 按键效果
        function pressKey(key) {
            key.classList.add('pressed');
            setTimeout(() => key.classList.remove('pressed'), 100);
        }

        // cos按键发光
        function cosKeyGlow() {
            cosKey.classList.add('active');
            setTimeout(() => cosKey.classList.remove('active'), 150);
        }

        // 脉冲效果
        function pulse() {
            const rect = cosKey.getBoundingClientRect();
            const calcRect = calculator.getBoundingClientRect();
            pulseRing.style.left = (rect.left - calcRect.left + rect.width/2) + 'px';
            pulseRing.style.top = (rect.top - calcRect.top + rect.height/2) + 'px';
            pulseRing.classList.remove('active');
            void pulseRing.offsetWidth;
            pulseRing.classList.add('active');
        }

        // 闪电效果
        function flash() {
            lightning.classList.remove('flash');
            void lightning.offsetWidth;
            lightning.classList.add('flash');
        }

        // 更新显示 - 修复显示问题
        function updateDisplay(value, glitch = false) {
            if (typeof value === 'number') {
                // 根据数值大小调整显示精度
                if (Math.abs(value) >= 100) {
                    displayText.textContent = value.toFixed(6);
                } else if (Math.abs(value) >= 10) {
                    displayText.textContent = value.toFixed(7);
                } else {
                    displayText.textContent = value.toFixed(9);
                }
            } else {
                displayText.textContent = value;
            }
            
            if (glitch) {
                displayText.classList.add('glitch');
                setTimeout(() => displayText.classList.remove('glitch'), 100);
            }
        }

        // 输入数字动画
        async function typeNumber(num) {
            const numStr = num.toString();
            displayText.textContent = '';
            for (let i = 0; i < numStr.length; i++) {
                displayText.textContent += numStr[i];
                const key = document.querySelector(`[data-num="${numStr[i]}"]`);
                if (key) pressKey(key);
                await new Promise(r => setTimeout(r, 200));
            }
            currentValue = num;
        }

        // cos迭代动画
        async function cosIteration(iterations, speed = 100) {
            convergenceBar.classList.add('show');
            convergenceLabel.classList.add('show');
            iterationCounter.classList.add('show');
            calculator.classList.add('shake');
            
            for (let i = 0; i < iterations; i++) {
                currentValue = Math.cos(currentValue);
                
                cosKeyGlow();
                pulse();
                updateDisplay(currentValue, true);
                
                iterCount.textContent = i + 1;
                
                // 收敛进度
                const target = 0.7390851332;
                const diff = Math.abs(currentValue - target);
                const progress = Math.min(100, (1 - diff * 2) * 100);
                convergenceFill.style.width = progress + '%';
                
                // 速度随着收敛加快
                const delay = Math.max(30, speed - i * 2);
                await new Promise(r => setTimeout(r, delay));
                
                // 接近目标时闪光
                if (diff < 0.001 && Math.random() > 0.7) {
                    flash();
                }
            }
            
            calculator.classList.remove('shake');
        }

        // 主动画序列
        async function runAnimation() {
            isAnimating = true;
            restartBtn.classList.remove('show');
            evilFace.classList.remove('show');
            
            // 标题展示
            await new Promise(r => setTimeout(r, 4000));
            titleOverlay.classList.add('hidden');
            
            await new Promise(r => setTimeout(r, 1000));
            
            // 第一幕：输入数字
            await showCaption('某个平凡的午后', 2000);
            await showCaption('一个学生百无聊赖地打开了计算器', 2500);
            
            await typeNumber(5);
            await new Promise(r => setTimeout(r, 500));
            
            await showCaption('如果我一直按 cos 键，会发生什么？', 2500);
            
            // 第二幕：疯狂按cos
            displayLabel.textContent = 'cos → cos → cos...';
            vortex.classList.add('show');
            
            await cosIteration(60, 80);
            
            vortex.classList.remove('show');
            calculator.classList.remove('shake');
            
            await new Promise(r => setTimeout(r, 500));
            await showCaption('数字...停止了跳动', 2500);
            await showCaption('0.739085133...', 2500);
            
            // 第三幕：换个数字再试
            await showCaption('一定是哪里出了问题', 2000);
            await showCaption('换一个完全不同的数字试试', 2500);
            
            convergenceBar.classList.remove('show');
            convergenceLabel.classList.remove('show');
            iterationCounter.classList.remove('show');
            convergenceFill.style.width = '0%';
            
            await new Promise(r => setTimeout(r, 500));
            await typeNumber(999);
            displayLabel.textContent = 'RAD';
            
            await new Promise(r => setTimeout(r, 800));
            
            displayLabel.textContent = 'cos → cos → cos...';
            vortex.classList.add('show');
            
            await cosIteration(80, 60);
            
            vortex.classList.remove('show');
            
            await new Promise(r => setTimeout(r, 500));
            await showCaption('不可能...', 2000);
            await showCaption('又是这个数字', 2500);
            
            // 第四幕：揭示真相
            flash();
            await new Promise(r => setTimeout(r, 200));
            flash();
            await new Promise(r => setTimeout(r, 200));
            flash();
            
            await showCaption('这是 cos 函数的不动点', 2500);
            await showCaption('数学世界中的黑洞', 2500);
            await showCaption('无论从哪个数字开始', 2000);
            await showCaption('最终都将折叠于此', 2500);
            
            // 邪恶笑脸登场
            evilFace.classList.add('show');
            
            await new Promise(r => setTimeout(r, 5000));
            
            restartBtn.classList.add('show');
            isAnimating = false;
        }

        // 重启
        restartBtn.addEventListener('click', () => {
            if (isAnimating) return;
            
            // 重置状态
            titleOverlay.classList.remove('hidden');
            evilFace.classList.remove('show');
            convergenceBar.classList.remove('show');
            convergenceLabel.classList.remove('show');
            iterationCounter.classList.remove('show');
            vortex.classList.remove('show');
            displayText.textContent = '0';
            displayLabel.textContent = 'RAD';
            convergenceFill.style.width = '0%';
            iterCount.textContent = '0';
            restartBtn.classList.remove('show');
            currentValue = 0;
            
            setTimeout(runAnimation, 500);
        });

        // 开始动画
        runAnimation();
    </script>
</body>
</html>